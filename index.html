<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reconocimiento de Voz</title>
</head>
<body>
    <h1>Reconocimiento de Voz y Acumulación de Texto</h1>

    <button id="startButton">Iniciar</button>
    <button id="stopButton" disabled>Fin</button>
    <button id="saveButton" disabled>Guardar</button>
    <button id="downloadButton" disabled>Descargar</button>

    <h2>Texto Reconocido en Tiempo Real:</h2>
    <p id="realTimeText">Esperando...</p>

    <h2>Texto Acumulado:</h2>
    <pre id="accumulatedText">Esperando...</pre>

    <script>
        const startButton = document.getElementById("startButton");
        const stopButton = document.getElementById("stopButton");
        const saveButton = document.getElementById("saveButton");
        const downloadButton = document.getElementById("downloadButton");
        const realTimeText = document.getElementById("realTimeText");
        const accumulatedText = document.getElementById("accumulatedText");

        let recognition;
        let accumulatedTranscript = ""; // Texto acumulado

        // Configuración del reconocimiento de voz
        function initSpeechRecognition() {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = "es-AR"; // Español (Argentina)
            recognition.interimResults = true;

            recognition.onresult = (event) => {
                let currentTranscript = "";

                for (const result of event.results) {
                    currentTranscript += result[0].transcript;
                }

                realTimeText.innerText = currentTranscript;

                // Acumular texto solo cuando el resultado es final
                if (event.results[0].isFinal) {
                    accumulatedTranscript += `\n------------------------------------\nFecha y hora: ${new Date().toLocaleString()}\n${currentTranscript}`;
                    realTimeText.innerText = "Esperando..."; // Limpiar el texto en tiempo real después de cada resultado final
                }
            };

            recognition.onend = () => {
                stopButton.disabled = true;
                saveButton.disabled = false;
                downloadButton.disabled = false;
                accumulatedText.innerText = accumulatedTranscript; // Mostrar todo el texto acumulado al final
            };
        }

        // Iniciar reconocimiento de voz
        startButton.addEventListener("click", () => {
            initSpeechRecognition();
            recognition.start();
            startButton.disabled = true;
            stopButton.disabled = false;
            saveButton.disabled = true;
            downloadButton.disabled = true;
            realTimeText.innerText = "Escuchando...";
        });

        // Detener reconocimiento de voz
        stopButton.addEventListener("click", () => {
            recognition.stop();
            startButton.disabled = false;
        });

        // Guardar texto acumulado en un archivo
        saveButton.addEventListener("click", () => {
            const fileName = prompt("Ingresa el nombre del archivo:", "transcripcion.txt");
            if (fileName) {
                downloadButton.disabled = false;
            }
        });

        // Descargar archivo acumulado
        downloadButton.addEventListener("click", () => {
            const blob = new Blob([accumulatedTranscript], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = fileName || "transcripcion.txt";
            link.click();
            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>

